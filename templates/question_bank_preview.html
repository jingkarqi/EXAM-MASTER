{% extends "base.html" %}

{% block title %}题库预览 - ExamMaster{% endblock %}

{% block styles %}
<style>
    .bank-card__stats {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        color: var(--gray-600);
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header mb-3">
    <h1 class="page-title">
        <i class="fas fa-eye"></i>
        {{ summary.name }}
    </h1>
    <p class="page-subtitle text-muted">{{ summary.description or '暂无描述' }}</p>
</div>

<div class="card mb-4">
    <div class="card-title d-flex justify-content-between align-items-center">
        <span><i class="fas fa-layer-group"></i> 题库信息</span>
        <div class="d-flex gap-2">
            {% if not is_active %}
            <form method="post" action="{{ url_for('question_bank.activate_bank', bank_id=summary.id) }}">
                <button type="submit" class="btn btn-primary btn-sm">
                    <i class="fas fa-check"></i> 设为当前
                </button>
            </form>
            {% else %}
            <span class="badge badge-success">当前正在使用</span>
            {% endif %}
            <a href="{{ url_for('question_bank.list_banks') }}" class="btn btn-outline-secondary btn-sm">
                <i class="fas fa-arrow-left"></i> 返回管理
            </a>
        </div>
    </div>
    <div class="bank-card__stats">
        <span><i class="fas fa-layer-group"></i> {{ summary.question_count or 0 }} 题</span>
        {% if summary.last_updated %}
            <span><i class="fas fa-clock"></i> 最近更新 {{ summary.last_updated }}</span>
        {% endif %}
    </div>
</div>

<div class="preview-section">
    <div class="section-header">
        <i class="fas fa-list"></i>
        <h3>题目预览</h3>
    </div>
    {% if questions %}
        <p class="text-muted mb-3">展示前 {{ questions|length }} 道题目，完整题库请在练习页面查看。</p>
        <div class="questions-preview">
            {% for question in questions %}
            <div class="question-preview-card">
                <div class="question-header" onclick="toggleQuestion(this)">
                    <div class="question-info">
                        <span class="question-id">#{{ question.id }}</span>
                        <span class="question-type">{{ question.qtype or '题型未知' }}</span>
                        {% if question.difficulty %}
                        <span class="question-difficulty">{{ question.difficulty }}</span>
                        {% endif %}
                    </div>
                    <div class="question-toggle">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="question-content">
                    <div class="question-stem">
                        <strong>题干：</strong>{{ question.stem }}
                    </div>
                    <div class="question-options">
                        {% for key, value in question.options.items() %}
                        <div class="question-option">
                            <span class="option-label">{{ key }}：</span>
                            <span class="option-text">{{ value }}</span>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="question-answer">
                        <strong>答案：</strong>
                        <span class="answer-text">{{ question.answer }}</span>
                    </div>
                    {% if question.category %}
                    <div class="question-category">
                        <strong>类别：</strong>{{ question.category }}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> 该题库暂无题目，请前往导入页面添加题目。
        </div>
    {% endif %}
</div>

{% endblock %}

{% block scripts %}
<script>
function toggleQuestion(header) {
    const card = header.parentElement;
    const content = card.querySelector('.question-content');
    const toggleIcon = header.querySelector('.question-toggle i');

    if (content.style.display === 'none' || !content.style.display) {
        content.style.display = 'block';
        toggleIcon.classList.remove('fa-chevron-down');
        toggleIcon.classList.add('fa-chevron-up');
    } else {
        content.style.display = 'none';
        toggleIcon.classList.remove('fa-chevron-up');
        toggleIcon.classList.add('fa-chevron-down');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const firstHeader = document.querySelector('.question-preview-card .question-header');
    if (firstHeader) {
        toggleQuestion(firstHeader);
    }
});
</script>
{% endblock %}
